# ç³»ç»Ÿæ¶æ„æ–‡æ¡£

## ğŸ“ æ•´ä½“æ¶æ„

SpringAI-MCP-RAG-Dev é‡‡ç”¨å¾®æœåŠ¡æ¶æ„ï¼Œç”±å‰ç«¯ã€ä¸¤ä¸ªåç«¯æœåŠ¡å’Œå¤šä¸ªå¤–éƒ¨æœåŠ¡ç»„æˆã€‚

### æ¶æ„å±‚æ¬¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           ç”¨æˆ·å±‚                                 â”‚
â”‚                      Web Browser / Mobile                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â”‚ HTTP/WebSocket/SSE
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          å‰ç«¯å±‚                                  â”‚
â”‚                   Vue 3 + TypeScript + Vite                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚  Chat UI     â”‚  â”‚  Audio UI    â”‚  â”‚  Upload UI   â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â”‚ REST API / WebSocket / SSE
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       API ç½‘å…³å±‚                                 â”‚
â”‚                   Spring Boot 3.5.6                             â”‚
â”‚                   Port: 9009 (MCP Client)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                    â”‚                    â”‚
        â–¼                    â–¼                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Controller   â”‚    â”‚ WebSocket    â”‚    â”‚ SSE          â”‚
â”‚ Layer        â”‚    â”‚ Handler      â”‚    â”‚ Controller   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                   â”‚                    â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        æœåŠ¡å±‚                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ ChatService  â”‚  â”‚ AudioService â”‚  â”‚ VideoService â”‚         â”‚
â”‚  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚         â”‚
â”‚  â”‚ - å¯¹è¯ç®¡ç†   â”‚  â”‚ - ASRè¯†åˆ«    â”‚  â”‚ - è§†é¢‘åˆ†æ   â”‚         â”‚
â”‚  â”‚ - ä¸Šä¸‹æ–‡     â”‚  â”‚ - TTSåˆæˆ    â”‚  â”‚ - å¸§æå–     â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ RAGService   â”‚  â”‚ ImageService â”‚  â”‚SearchService â”‚         â”‚
â”‚  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚         â”‚
â”‚  â”‚ - æ–‡æ¡£è§£æ   â”‚  â”‚ - å›¾åƒç†è§£   â”‚  â”‚ - ç½‘ç»œæœç´¢   â”‚         â”‚
â”‚  â”‚ - å‘é‡æ£€ç´¢   â”‚  â”‚ - æè¿°ç”Ÿæˆ   â”‚  â”‚ - ç»“æœæ•´åˆ   â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                    â”‚                    â”‚
        â–¼                    â–¼                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AI Models   â”‚    â”‚  MCP Server  â”‚    â”‚ Data Layer   â”‚
â”‚              â”‚    â”‚  Port: 9060  â”‚    â”‚              â”‚
â”‚ - OpenAI     â”‚    â”‚              â”‚    â”‚ - Redis      â”‚
â”‚ - DeepSeek   â”‚    â”‚ - Email Tool â”‚    â”‚ - MySQL      â”‚
â”‚ - Qwen       â”‚    â”‚ - DB Tool    â”‚    â”‚              â”‚
â”‚ - ZhipuAI    â”‚    â”‚ - File Tool  â”‚    â”‚              â”‚
â”‚ - Ollama     â”‚    â”‚              â”‚    â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ›ï¸ åˆ†å±‚æ¶æ„

### 1. è¡¨ç¤ºå±‚ï¼ˆPresentation Layerï¼‰

**èŒè´£**ï¼šå¤„ç†ç”¨æˆ·è¯·æ±‚ï¼Œè¿”å›å“åº”

**ç»„ä»¶**ï¼š
- `Controller`: REST API ç«¯ç‚¹
- `WebSocketController`: WebSocket å¤„ç†å™¨
- `SSEController`: Server-Sent Events å¤„ç†å™¨

**æŠ€æœ¯**ï¼š
- Spring MVC
- Spring WebFlux (for SSE)
- Spring WebSocket

### 2. ä¸šåŠ¡é€»è¾‘å±‚ï¼ˆBusiness Logic Layerï¼‰

**èŒè´£**ï¼šæ ¸å¿ƒä¸šåŠ¡é€»è¾‘å¤„ç†

**ç»„ä»¶**ï¼š
- `ChatService`: å¯¹è¯ç®¡ç†
- `DocumentService`: RAG æ–‡æ¡£å¤„ç†
- `AudioService`: éŸ³é¢‘å¤„ç†ï¼ˆASR/TTSï¼‰
- `VideoService`: è§†é¢‘åˆ†æ
- `ImageService`: å›¾åƒå¤„ç†
- `MultiModelService`: å¤šæ¨¡å‹è°ƒåº¦
- `SearXngService`: æœç´¢æœåŠ¡

**ç‰¹æ€§**ï¼š
- å¼‚æ­¥å¤„ç†
- æµå¼å“åº”
- é”™è¯¯å¤„ç†
- æ—¥å¿—è®°å½•

### 3. æ•°æ®è®¿é—®å±‚ï¼ˆData Access Layerï¼‰

**èŒè´£**ï¼šæ•°æ®æŒä¹…åŒ–å’Œæ£€ç´¢

**ç»„ä»¶**ï¼š
- `VectorStore`: å‘é‡æ•°æ®å­˜å‚¨ï¼ˆRedisï¼‰
- `Mapper`: æ•°æ®åº“è®¿é—®ï¼ˆMyBatis-Plusï¼‰
- `Repository`: æ•°æ®ä»“åº“æ¥å£

### 4. å¤–éƒ¨é›†æˆå±‚ï¼ˆExternal Integration Layerï¼‰

**èŒè´£**ï¼šä¸å¤–éƒ¨æœåŠ¡é›†æˆ

**é›†æˆæœåŠ¡**ï¼š
- AI æ¨¡å‹ APIï¼ˆOpenAI, Qwen, ZhipuAIï¼‰
- MCP Server
- SearXNG
- Ollama

## ğŸ”„ æ ¸å¿ƒæµç¨‹

### å¯¹è¯æµç¨‹

```
ç”¨æˆ·è¾“å…¥
   â”‚
   â–¼
Controller æ¥æ”¶è¯·æ±‚
   â”‚
   â–¼
ChatService å¤„ç†
   â”‚
   â”œâ”€â†’ ä¸Šä¸‹æ–‡ç®¡ç†ï¼ˆä¼šè¯å†å²ï¼‰
   â”‚
   â”œâ”€â†’ æ¨¡å‹é€‰æ‹©ï¼ˆOpenAI/Qwen/ZhipuAIï¼‰
   â”‚
   â”œâ”€â†’ è°ƒç”¨ AI API
   â”‚
   â”œâ”€â†’ æµå¼å“åº”å¤„ç†
   â”‚
   â””â”€â†’ SSE æ¨é€ç»™å‰ç«¯
```

### RAG æ£€ç´¢æµç¨‹

```
ç”¨æˆ·é—®é¢˜
   â”‚
   â–¼
1. é—®é¢˜å‘é‡åŒ–ï¼ˆEmbeddingï¼‰
   â”‚
   â–¼
2. å‘é‡æ£€ç´¢ï¼ˆRedis Vector Searchï¼‰
   â”‚
   â”œâ”€â†’ ç›¸ä¼¼åº¦è®¡ç®—
   â”œâ”€â†’ TopK æ£€ç´¢
   â””â”€â†’ è·å–ç›¸å…³æ–‡æ¡£
   â”‚
   â–¼
3. æ„å»ºå¢å¼ºæç¤ºè¯
   â”‚
   â”œâ”€â†’ åŸå§‹é—®é¢˜
   â”œâ”€â†’ æ£€ç´¢åˆ°çš„æ–‡æ¡£ä¸Šä¸‹æ–‡
   â””â”€â†’ ç³»ç»Ÿæç¤º
   â”‚
   â–¼
4. è°ƒç”¨ AI æ¨¡å‹ç”Ÿæˆå›ç­”
   â”‚
   â–¼
5. è¿”å›ç»“æœ
```

### æ–‡æ¡£ä¸Šä¼ æµç¨‹

```
æ–‡æ¡£ä¸Šä¼ 
   â”‚
   â–¼
1. æ–‡ä»¶éªŒè¯ï¼ˆæ ¼å¼ã€å¤§å°ï¼‰
   â”‚
   â–¼
2. æ–‡æ¡£è§£æ
   â”‚
   â”œâ”€â†’ PDF: TikaDocumentReader
   â”œâ”€â†’ DOCX: TikaDocumentReader
   â””â”€â†’ MD: MarkdownDocumentReader
   â”‚
   â–¼
3. æ–‡æœ¬åˆ†å—ï¼ˆChunkingï¼‰
   â”‚
   â”œâ”€â†’ åˆ†å—ç­–ç•¥
   â”œâ”€â†’ é‡å è®¾ç½®
   â””â”€â†’ å…ƒæ•°æ®ä¿ç•™
   â”‚
   â–¼
4. å‘é‡åŒ–ï¼ˆEmbeddingï¼‰
   â”‚
   â””â”€â†’ Ollama Embedding Model
   â”‚
   â–¼
5. å­˜å‚¨åˆ°å‘é‡æ•°æ®åº“ï¼ˆRedisï¼‰
   â”‚
   â””â”€â†’ ç´¢å¼•åç§°
   â””â”€â†’ å‘½åç©ºé—´
```

### å®æ—¶è¯­éŸ³è¯†åˆ«æµç¨‹

```
WebSocket è¿æ¥å»ºç«‹
   â”‚
   â–¼
å‰ç«¯é‡‡é›†éŸ³é¢‘
   â”‚
   â”œâ”€â†’ éº¦å…‹é£æ•è·
   â”œâ”€â†’ éŸ³é¢‘ç¼–ç 
   â””â”€â†’ æ•°æ®åˆ†ç‰‡
   â”‚
   â–¼
WebSocket ä¼ è¾“éŸ³é¢‘æ•°æ®
   â”‚
   â–¼
åç«¯æ¥æ”¶éŸ³é¢‘æµ
   â”‚
   â”œâ”€â†’ ç¼“å†²å¤„ç†
   â””â”€â†’ æµå¼ ASR è¯†åˆ«
   â”‚
   â–¼
å®æ—¶è¿”å›è¯†åˆ«ç»“æœ
   â”‚
   â””â”€â†’ WebSocket æ¨é€
```

## ğŸ”Œ MCP åè®®é›†æˆ

### MCP Client æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         MCP Client Service              â”‚
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   MCP Connection Manager        â”‚   â”‚
â”‚  â”‚                                 â”‚   â”‚
â”‚  â”‚  - SSE Connections              â”‚   â”‚
â”‚  â”‚  - STDIO Connections            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   Tool Registry                 â”‚   â”‚
â”‚  â”‚                                 â”‚   â”‚
â”‚  â”‚  - Discover Tools               â”‚   â”‚
â”‚  â”‚  - Tool Metadata                â”‚   â”‚
â”‚  â”‚  - Parameter Validation         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   Tool Executor                 â”‚   â”‚
â”‚  â”‚                                 â”‚   â”‚
â”‚  â”‚  - Execute Tool Calls           â”‚   â”‚
â”‚  â”‚  - Result Processing            â”‚   â”‚
â”‚  â”‚  - Error Handling               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### MCP Server æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         MCP Server Service              â”‚
â”‚          Port: 9060                     â”‚
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   SSE Endpoint                  â”‚   â”‚
â”‚  â”‚   /sse                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   Message Handler               â”‚   â”‚
â”‚  â”‚   /mcp/message                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   Tools                         â”‚   â”‚
â”‚  â”‚                                 â”‚   â”‚
â”‚  â”‚  â”œâ”€ Email Tool                  â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€ sendEmail()              â”‚   â”‚
â”‚  â”‚  â”‚                              â”‚   â”‚
â”‚  â”‚  â”œâ”€ Database Tool               â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€ queryDatabase()          â”‚   â”‚
â”‚  â”‚  â”‚                              â”‚   â”‚
â”‚  â”‚  â””â”€ Custom Tools                â”‚   â”‚
â”‚  â”‚     â””â”€ customOperation()        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ’¾ æ•°æ®æ¨¡å‹

### å‘é‡æ•°æ®ï¼ˆRedisï¼‰

```
Key: embedding:{namespace}:{docId}
Value: {
  id: "doc-123",
  content: "æ–‡æ¡£å†…å®¹...",
  embedding: [0.1, 0.2, ...], // 768ç»´å‘é‡
  metadata: {
    source: "document.pdf",
    page: 1,
    timestamp: "2025-01-01T00:00:00Z"
  }
}

Index: my-vector-index
- Vector Similarity Search (COSINE)
- Metadata Filtering
```

### ç»“æ„åŒ–æ•°æ®ï¼ˆMySQLï¼‰

```sql
-- ç”¨æˆ·è¡¨
CREATE TABLE users (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    username VARCHAR(50) UNIQUE NOT NULL,
    email VARCHAR(100),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- ä¼šè¯è¡¨
CREATE TABLE chat_sessions (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT,
    session_id VARCHAR(100) UNIQUE NOT NULL,
    model VARCHAR(50),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id)
);

-- æ¶ˆæ¯è¡¨
CREATE TABLE chat_messages (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    session_id VARCHAR(100),
    role VARCHAR(20), -- user/assistant/system
    content TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (session_id) REFERENCES chat_sessions(session_id)
);

-- MCP å·¥å…·è°ƒç”¨è®°å½•
CREATE TABLE mcp_tool_logs (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    tool_name VARCHAR(100),
    parameters JSON,
    result TEXT,
    status VARCHAR(20),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

## ğŸ” å®‰å…¨æ¶æ„

### 1. è®¤è¯ä¸æˆæƒ

- **JWT Token**ï¼šç”¨æˆ·èº«ä»½éªŒè¯
- **API Key**ï¼šå¤–éƒ¨ API è®¿é—®æ§åˆ¶
- **ç¯å¢ƒå˜é‡**ï¼šæ•æ„Ÿä¿¡æ¯ç®¡ç†

### 2. æ•°æ®å®‰å…¨

- **ä¼ è¾“åŠ å¯†**ï¼šHTTPS/WSS
- **å­˜å‚¨åŠ å¯†**ï¼šæ•æ„Ÿæ•°æ®åŠ å¯†å­˜å‚¨
- **è®¿é—®æ§åˆ¶**ï¼šåŸºäºè§’è‰²çš„æƒé™ç®¡ç†

### 3. è¾“å…¥éªŒè¯

- **å‚æ•°æ ¡éªŒ**ï¼šBean Validation
- **æ–‡ä»¶ä¸Šä¼ é™åˆ¶**ï¼šæ–‡ä»¶ç±»å‹ã€å¤§å°é™åˆ¶
- **SQL æ³¨å…¥é˜²æŠ¤**ï¼šå‚æ•°åŒ–æŸ¥è¯¢

## ğŸš€ æ€§èƒ½ä¼˜åŒ–

### 1. ç¼“å­˜ç­–ç•¥

```java
@Cacheable(value = "embeddings", key = "#text")
public float[] getEmbedding(String text) {
    // è®¡ç®— Embedding
}
```

### 2. å¼‚æ­¥å¤„ç†

```java
@Async
public CompletableFuture<String> processDocument(MultipartFile file) {
    // å¼‚æ­¥å¤„ç†æ–‡æ¡£
}
```

### 3. è¿æ¥æ± é…ç½®

```yaml
spring:
  data:
    redis:
      jedis:
        pool:
          max-active: 8
          max-idle: 8
          min-idle: 2
```

### 4. æµå¼å“åº”

```java
@GetMapping(value = "/stream", produces = MediaType.TEXT_EVENT_STREAM_VALUE)
public Flux<String> streamResponse() {
    // SSE æµå¼å“åº”
}
```

## ğŸ“Š ç›‘æ§ä¸æ—¥å¿—

### 1. æ—¥å¿—æ¶æ„

```
Application Logs
   â”œâ”€â†’ Controller Logs (è¯·æ±‚/å“åº”)
   â”œâ”€â†’ Service Logs (ä¸šåŠ¡é€»è¾‘)
   â”œâ”€â†’ Integration Logs (å¤–éƒ¨è°ƒç”¨)
   â””â”€â†’ Error Logs (å¼‚å¸¸)
```

### 2. ç›‘æ§æŒ‡æ ‡

- **è¯·æ±‚æŒ‡æ ‡**ï¼šQPSã€å“åº”æ—¶é—´ã€é”™è¯¯ç‡
- **ç³»ç»ŸæŒ‡æ ‡**ï¼šCPUã€å†…å­˜ã€ç£ç›˜
- **ä¸šåŠ¡æŒ‡æ ‡**ï¼šå¯¹è¯æ•°ã€æ–‡æ¡£æ•°ã€å·¥å…·è°ƒç”¨æ•°

### 3. æ—¥å¿—åˆ‡é¢

```java
@Aspect
@Component
public class ServiceLogAspect {
    @Around("@annotation(com.yeling.annotation.ServiceLog)")
    public Object logServiceExecution(ProceedingJoinPoint joinPoint) {
        // è®°å½•æœåŠ¡è°ƒç”¨æ—¥å¿—
    }
}
```

## ğŸ”„ æ‰©å±•æ€§è®¾è®¡

### 1. æ¨¡å‹æŠ½è±¡

```java
public interface ChatModel {
    ChatResponse chat(ChatRequest request);
    Flux<ChatResponse> stream(ChatRequest request);
}

// å®ç°
- OpenAIChatModel
- QwenChatModel
- ZhipuAIChatModel
- OllamaChatModel
```

### 2. MCP å·¥å…·æ‰©å±•

```java
@McpTool(
    name = "customTool",
    description = "è‡ªå®šä¹‰å·¥å…·",
    parameters = CustomToolParams.class
)
public String executeCustomTool(CustomToolParams params) {
    // å·¥å…·é€»è¾‘
}
```

### 3. æ–‡æ¡£è¯»å–å™¨æ‰©å±•

```java
public interface DocumentReader {
    List<Document> read(Resource resource);
}

// å®ç°
- TikaDocumentReader (PDF, DOCX, etc.)
- MarkdownDocumentReader
- CustomDocumentReader (æ‰©å±•)
```

---

## ğŸ“š å‚è€ƒèµ„æ–™

- [Spring AI å®˜æ–¹æ–‡æ¡£](https://docs.spring.io/spring-ai/reference/)
- [Model Context Protocol](https://modelcontextprotocol.io/)
- [Redis Vector Similarity Search](https://redis.io/docs/stack/search/reference/vectors/)
- [Spring WebFlux](https://docs.spring.io/spring-framework/reference/web/webflux.html)

